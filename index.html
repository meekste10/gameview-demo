<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FunBall ‚Äî Dual-View with Players</title>
<style>
:root {
  --bg:#101820; --field1:#0b6623; --field2:#0a4f1a;
  --ball:#ffd97a; --trail:rgba(255,217,122,0.15);
  --home:#72b6e5; --away:#ff6a6a;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg);color:#fff;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh
}
h1{margin:10px 0;font-size:1.4rem}
.view{border:2px solid #333;border-radius:8px;margin:8px 0;position:relative}
canvas{width:90vw;max-width:800px;height:auto;display:block;border-radius:6px}
#hud{margin-top:10px;font-size:0.9rem;opacity:.8}
</style>
</head>
<body>
<h1>üèà FunBall ‚Äî Dual View + Players</h1>

<div class="view"><canvas id="canvasXY" width="1200" height="533"></canvas></div>
<div class="view"><canvas id="canvasZ"  width="1200" height="400"></canvas></div>
<div id="hud">Loading‚Ä¶</div>

<script>
(async()=>{
  const hud=document.getElementById("hud");
  const cvsXY=document.getElementById("canvasXY");
  const cvsZ=document.getElementById("canvasZ");
  const ctxXY=cvsXY.getContext("2d");
  const ctxZ=cvsZ.getContext("2d");

  // ---- Load ----
  let data;
  try{
    const res=await fetch("funball_play.json",{cache:"no-cache"});
    data=await res.json();
  }catch(e){hud.textContent="‚ùå Could not load funball.json";console.error(e);return;}

  const frames=data.frames||[];
  const fps=data.fps||10;
  const tick=1000/fps;
  let frame=0;

  // ---- Draw helpers ----
  function drawField(ctx){
    const w=ctx.canvas.width,h=ctx.canvas.height;
    ctx.fillStyle=ctx.createLinearGradient(0,0,w,0);
    ctx.fillStyle.addColorStop?.(0,"var(--field1)");
    ctx.fillStyle.addColorStop?.(1,"var(--field2)");
    ctx.fillRect(0,0,w,h);
  }

  function drawPlayers(ctx, players, mode="XY"){
    if(!players) return;
    for(const p of players){
      const x=p.x,y=p.y,z=p.z||0;
      const w=ctx.canvas.width,h=ctx.canvas.height;
      const px=(x/120)*w;
      const py=mode==="XY"?h-(y/53.333)*h:h-((y+z*8)/53.333)*h;
      const r=4+(z*2);
      ctx.fillStyle=p.team==="home"?"var(--home)":"var(--away)";
      ctx.beginPath();ctx.arc(px,py,r,0,Math.PI*2);ctx.fill();
    }
  }

  function drawBall(ctx,x,y,z,mode="XY"){
    const w=ctx.canvas.width,h=ctx.canvas.height;
    const px=(x/120)*w;
    const py=mode==="XY"?h-(y/53.333)*h:h-((y+z*8)/53.333)*h;
    const r=8+z*4;

    // Shadow for tilt
    if(mode==="Z"){
      const shadowY=h-(y/53.333)*h;
      ctx.fillStyle="rgba(0,0,0,0.25)";
      ctx.beginPath();ctx.ellipse(px,shadowY,r*1.4,r*0.5,0,0,Math.PI*2);ctx.fill();
    }

    // Trail + glow
    ctx.fillStyle="var(--trail)";
    ctx.beginPath();ctx.arc(px,py,r*2.5,0,Math.PI*2);ctx.fill();

    const grad=ctx.createRadialGradient(px,py,r*0.2,px,py,r);
    grad.addColorStop(0,"#fff6b0"); grad.addColorStop(1,"#ff9a00");
    ctx.fillStyle=grad;
    ctx.beginPath();ctx.arc(px,py,r,0,Math.PI*2);ctx.fill();
  }

  function drawFrame(){
    ctxXY.clearRect(0,0,cvsXY.width,cvsXY.height);
    ctxZ.clearRect(0,0,cvsZ.width,cvsZ.height);
    drawField(ctxXY); drawField(ctxZ);

    const f=frames[frame];
    if(!f||!f.ball) return;
    const {x,y,z}=f.ball;
    drawPlayers(ctxXY,f.players,"XY");
    drawPlayers(ctxZ,f.players,"Z");
    drawBall(ctxXY,x,y,z,"XY");
    drawBall(ctxZ,x,y,z,"Z");

    hud.textContent=`Frame ${frame+1}/${frames.length} ‚Ä¢ t=${f.time_s.toFixed(2)}s`;
    frame=(frame+1)%frames.length;
  }

  function loop(){drawFrame();setTimeout(loop,tick);}
  hud.textContent=`‚úÖ Loaded ${frames.length} frames`;
  loop();
})();
</script>
</body>
</html>
