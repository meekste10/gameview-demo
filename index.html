<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GameView ‚Äî Ethical Telemetry Prototype</title>
<style>
:root {
  --charcoal:#101820;--gold:#ffd97a;--sky:#72b6e5;
  --field1:#0b6623;--field2:#0a4f1a;
}
body{margin:0;background:var(--charcoal);color:#fff;
     font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
header{padding:14px 16px;border-bottom:2px solid #223;
       display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
h1{font-size:18px;margin:0;}
.badge{background:var(--sky);color:#000;font-weight:700;
       padding:6px 10px;border-radius:10px;transition:opacity .5s;}
#wrap{max-width:900px;margin:0 auto;}
canvas{width:100%;aspect-ratio:2/1;background:linear-gradient(var(--field1),var(--field2));
       border:4px solid var(--gold);border-radius:10px;display:block;}
#controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:10px 0;}
button{flex:1 1 180px;padding:14px 16px;font-size:16px;font-weight:700;
       border:0;border-radius:10px;}
#nextPlay{background:var(--gold);color:#000;}
.toggle{background:#1f2937;color:#fff;border:1px solid #334155;}
#dataLog{max-width:900px;margin:10px auto;padding:10px 12px;
         border:1px solid #233;border-radius:8px;background:#0e1420;
         font-size:14px;line-height:1.35;max-height:180px;overflow:auto;}
.ok{color:#94f7c5}.info{color:#c6e2ff}.warn{color:#ffdf99}
footer{max-width:900px;margin:0 auto 18px;padding:8px 12px;opacity:.8;font-size:12px;color:#bcd;}
#contextNote{position:fixed;bottom:6px;right:10px;font-size:11px;
             background:rgba(16,24,32,.65);padding:6px 8px;border-radius:6px;color:#9cc;z-index:99;}
</style>
</head>
<body>
<header>
  <h1>üèà GameView ‚Äî Data Becomes Drama</h1>
  <div class="badge" id="trustBadge">Visible Truth ‚Ä¢ 1.5 s Delay ‚úì</div>
</header>

<div id="wrap">
  <canvas id="field" width="900" height="450"></canvas>
  <div id="controls">
    <button id="nextPlay">üì° Engage Synthetic Play</button>
    <button id="toggleCoach" class="toggle">Coach Mode OFF</button>
    <button id="toggleMotion" class="toggle">Reduce Motion OFF</button>
  </div>
  <div id="dataLog" aria-live="polite"></div>
</div>

<footer>¬© 2025 GameView LLC ‚Ä¢ Ethics-as-UX Demo ‚Ä¢ Practice Data Only</footer>
<div id="contextNote">Synthetic replay ¬∑ no live athlete data</div>

<script>
/* ---------- State ---------- */
const trust=document.getElementById('trustBadge'),
      logEl=document.getElementById('dataLog'),
      nextBtn=document.getElementById('nextPlay'),
      coachBtn=document.getElementById('toggleCoach'),
      motionBtn=document.getElementById('toggleMotion'),
      canvas=document.getElementById('field'),ctx=canvas.getContext('2d');
let reduceMotion=false,coachMode=false,animRAF=null;

/* ---------- Draw field on normalized grid (0‚Äì100x0‚Äì53) ---------- */
function drawField(){
  const w=canvas.width,h=canvas.height;
  ctx.clearRect(0,0,w,h);
  const grad=ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,"#0b6623");grad.addColorStop(1,"#0a4f1a");
  ctx.fillStyle=grad;ctx.fillRect(0,0,w,h);
  ctx.strokeStyle='rgba(255,255,255,.5)';
  for(let y=0;y<=10;y++){ // horizontal stripes (5-yard increments)
    const yy=y*(h/10);
    ctx.beginPath();ctx.moveTo(0,yy);ctx.lineTo(w,yy);ctx.stroke();
  }
  for(let x=0;x<=10;x++){ // vertical yardlines (10-yard)
    const xx=x*(w/10);
    ctx.beginPath();ctx.moveTo(xx,0);ctx.lineTo(xx,h);ctx.stroke();
  }
}

/* ---------- Logging ---------- */
function log(msg,cls=''){const d=document.createElement('div');
  d.className=cls;d.textContent=msg;logEl.prepend(d);}

/* ---------- UI Toggles ---------- */
motionBtn.onclick=()=>{reduceMotion=!reduceMotion;
  motionBtn.textContent=`Reduce Motion ${reduceMotion?'ON':'OFF'}`;};
coachBtn.onclick=()=>{coachMode=!coachMode;
  coachBtn.textContent=`Coach Mode ${coachMode?'ON':'OFF'}`;drawField();};

/* ---------- Helper ---------- */
function pulseBadge(){trust.animate([{opacity:1},{opacity:.5},{opacity:1}],{duration:1200});}

/* ---------- Plays & Tracks ---------- */
const plays=[
 {desc:"Short pass for 7 yards ‚Äì 1ST DOWN.",file:"balltrack_short.json"},
 {desc:"Deep left completion for 30 yards!",file:"balltrack_deep.json"},
 {desc:"Run up the middle for 5 yards.",file:"balltrack_run.json"},
 {desc:"Incomplete deep right ‚Äì QB pressure.",file:"balltrack_incomplete.json"}
];
let playIndex=-1;

/* ---------- Run Play ---------- */
async function runPlay(){
  playIndex=(playIndex+1)%plays.length;
  const p=plays[playIndex];
  pulseBadge();drawField();
  log(`üîÅ Next Play ‚Üí ${p.desc}`,'info');
  try{
    const res=await fetch(`${p.file}?v=${Date.now()}`); // cache-bust
    const data=await res.json();
    renderTrajectory(data,p.desc);
  }catch(e){log('Error loading track '+p.file,'warn');}
}

/* ---------- Trajectory Renderer ---------- */
function renderTrajectory(data,desc){
  const m=data.metadata;
  trust.style.background=m.trust_badge_color||'#72B6E5';
  trust.textContent=`Visible Truth ‚Ä¢ ${m.latency_s||1.5}s Delay ${m.consent?'‚úì':'‚úó'}`;
  const pts=data.trajectory.map(t=>({
    x:(t.x/10)*canvas.width*0.9+40,
    y:canvas.height-(t.y/5)*canvas.height*0.8-40
  }));
  ctx.beginPath();ctx.strokeStyle='#ffd97a';ctx.lineWidth=3;ctx.moveTo(pts[0].x,pts[0].y);
  let i=0;
  const step=()=>{
    if(i<pts.length){
      ctx.lineTo(pts[i].x,pts[i].y);ctx.stroke();
      if(data.sponsor.active&&i%2===0){
        ctx.beginPath();ctx.arc(pts[i].x,pts[i].y,2,0,Math.PI*2);
        ctx.fillStyle=data.sponsor.trail_color;ctx.fill();}
      i+=reduceMotion?pts.length:1;
      animRAF=requestAnimationFrame(step);
    }else{
      ctx.beginPath();ctx.arc(pts.at(-1).x,pts.at(-1).y,10,0,Math.PI*2);
      ctx.strokeStyle='rgba(255,217,122,.4)';ctx.stroke();
      setTimeout(()=>{ctx.globalAlpha=.3;drawField();ctx.globalAlpha=1;
        log('Awaiting next synthetic feed ‚Ä¶','info');},800);
    }
  };
  step();
}

/* ---------- Boot ---------- */
nextBtn.onclick=runPlay;
drawField();
log('Ready ¬∑ tap ‚Äúüì° Engage Synthetic Play‚Äù to begin.','info');
</script>
</body>
</html>
